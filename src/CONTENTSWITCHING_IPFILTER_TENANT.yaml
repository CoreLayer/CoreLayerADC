name: CONTENTSWITCHING_IPFILTER_TENANT
dependencies:
  - CORE
  - CONTENTSWITCHING_ENTRY
  - CONTENTSWITCHING_IPFILTER
placeholders:
  - name: PLH_LBV_IPFILTER_TENANT_HTTP
    expression: _V__LBV_IPFILTER_TENANT_HTTP
  - name: PLH_LBV_IPFILTER_TENANT_TCP
    expression: _V__LBV_IPFILTER_TENANT_TCP
  - name: PLH_LBV_IPFILTER_TENANT_UDP
    expression: _V__LBV_IPFILTER_TENANT_UDP

  - name: PLH_CSA_IPFILTER_TENANT_HTTP
    expression: _V__CSA_IPFILTER_TENANT_HTTP
  - name: PLH_CSA_IPFILTER_TENANT_TCP
    expression: _V__CSA_IPFILTER_TENANT_TCP
  - name: PLH_CSA_IPFILTER_TENANT_UDP
    expression: _V__CSA_IPFILTER_TENANT_UDP



  - name: PLH_CSP_GOTO_CSL_IPFILTER_TENANT_HTTP
    expression: _V__CSP_GOTO_CSL_IPFILTER_TENANT_HTTP
  - name: PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_HTTP
    expression: _V__CSP_IPFILTER_TENANT_NOT_CONFIGURED_HTTP
  - name: PLH_CSP_IPFILTER_TENANT_NOT_ENABLED_HTTP
    expression: _V__CSP_IPFILTER_TENANT_NOT_ENABLED_HTTP
  - name: PLH_CSP_IPFILTER_TENANT_IPV4_HTTP
    expression: _V__CSP_IPFILTER_TENANT_IPV4_HTTP
  - name: PLH_CSP_IPFILTER_TENANT_IPV6_HTTP
    expression: _V__CSP_IPFILTER_TENANT_IPV6_HTTP
  - name: PLH_CSL_IPFILTER_TENANT_HTTP
    expression: _V__CSL_IPFILTER_TENANT_HTTP


  - name: PLH_CSP_GOTO_CSL_IPFILTER_TENANT_TCP
    expression: _V__CSP_GOTO_CSL_IPFILTER_TENANT_TCP
  - name: PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_TCP
    expression: _V__CSP_IPFILTER_TENANT_NOT_CONFIGURED_TCP
  - name: PLH_CSL_IPFILTER_TENANT_TCP
    expression: _V__CSL_IPFILTER_TENANT_TCP

  - name: PLH_CSP_GOTO_CSL_IPFILTER_TENANT_UDP
    expression: _V__CSP_GOTO_CSL_IPFILTER_TENANT_UDP
  - name: PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_UDP
    expression: _V__CSP_IPFILTER_TENANT_NOT_CONFIGURED_UDP
  - name: PLH_CSL_IPFILTER_TENANT_UDP
    expression: _V__CSL_IPFILTER_TENANT_UDP




sections:
  - name: IPFILTER_TENANT - LBV
    elements:
      - name: LBV_IPFILTER_TENANT_HTTP
        references:
          - PLH_LBV_IPFILTER_TENANT_HTTP
          - PLH_SVG_DUMMY_HTTP
        dependencies:
          - SVG_DUMMY_HTTP
        expressions:
          install: |
            add lb vserver PLH_LBV_IPFILTER_TENANT_HTTP HTTP 0.0.0.0 0
            bind lb vserver PLH_LBV_IPFILTER_TENANT_HTTP PLH_SVG_DUMMY_HTTP
          uninstall: |
            unbind lb vserver PLH_LBV_IPFILTER_TENANT_HTTP PLH_SVG_DUMMY_HTTP
            rm lb vserver PLH_LBV_IPFILTER_TENANT_HTTP

      - name: LBV_IPFILTER_TENANT_TCP
        references:
          - PLH_LBV_IPFILTER_TENANT_TCP
          - PLH_SVG_DUMMY_TCP
        dependencies:
          - SVG_DUMMY_TCP
        expressions:
          install: |
            add lb vserver PLH_LBV_IPFILTER_TENANT_TCP HTTP 0.0.0.0 0
            bind lb vserver PLH_LBV_IPFILTER_TENANT_TCP PLH_SVG_DUMMY_TCP
          uninstall: |
            unbind lb vserver PLH_LBV_IPFILTER_TENANT_TCP PLH_SVG_DUMMY_TCP
            rm lb vserver PLH_LBV_IPFILTER_TENANT_TCP

      - name: LBV_IPFILTER_TENANT_UDP
        references:
          - PLH_LBV_IPFILTER_TENANT_UDP
          - PLH_SVG_DUMMY_UDP
        dependencies:
          - SVG_DUMMY_UDP
        expressions:
          install: |
            add lb vserver PLH_LBV_IPFILTER_TENANT_UDP HTTP 0.0.0.0 0
            bind lb vserver PLH_LBV_IPFILTER_TENANT_UDP PLH_SVG_DUMMY_UDP
          uninstall: |
            unbind lb vserver PLH_LBV_IPFILTER_TENANT_UDP PLH_SVG_DUMMY_UDP
            rm lb vserver PLH_LBV_IPFILTER_TENANT_UDP



  - name: IPFILTER_TENANT - CONTENT SWITCHING ACTIONS LBV
    elements:
      - name: CSA_IPFILTER_TENANT_HTTP
        references:
          - PLH_CSA_IPFILTER_TENANT_HTTP
          - PLH_LBV_IPFILTER_TENANT_HTTP
        dependencies:
          - LBV_IPFILTER_TENANT_HTTP
        expressions:
          install: add cs action PLH_CSA_IPFILTER_TENANT_HTTP -targetVserverExpr q{"PLH_LBV_IPFILTER_TENANT_HTTP"}
          uninstall: rm cs action PLH_CSA_IPFILTER_TENANT_HTTP
      - name: CSA_IPFILTER_TENANT_TCP
        references:
          - PLH_CSA_IPFILTER_TENANT_TCP
          - PLH_LBV_IPFILTER_TENANT_TCP
        dependencies:
          - LBV_IPFILTER_TENANT_TCP
        expressions:
          install: add cs action PLH_CSA_IPFILTER_TENANT_TCP -targetVserverExpr q{"PLH_LBV_IPFILTER_TENANT_TCP"}
          uninstall: rm cs action PLH_CSA_IPFILTER_TENANT_TCP
      - name: CSA_IPFILTER_TENANT_UDP
        references:
          - PLH_CSA_IPFILTER_TENANT_UDP
          - PLH_LBV_IPFILTER_TENANT_UDP
        dependencies:
          - LBV_IPFILTER_TENANT_UDP
        expressions:
          install: add cs action PLH_CSA_IPFILTER_TENANT_UDP -targetVserverExpr q{"PLH_LBV_IPFILTER_TENANT_UDP"}
          uninstall: rm cs action PLH_CSA_IPFILTER_TENANT_UDP



  - name: TrafficManagement.ContentSwitching.ContentSwitchingPolicyLabels
    elements:
      - name: CSL_IPFILTER_TENANT_HTTP
        references:
          - PLH_CSP_GOTO_CSL_IPFILTER_TENANT_HTTP
          - PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_HTTP
          - PLH_PSM_TENANT_IPV4_HTTP_KEY_EXISTS
          - PLH_CSA_IPFILTER_TENANT_HTTP
          - PLH_CSP_IPFILTER_TENANT_IPV4_HTTP
          - PLH_CSP_IPFILTER_TENANT_IPV6_HTTP
          - PLH_CSL_IPFILTER_TENANT_HTTP
          - PLH_CSL_ENTRY_HTTP
        dependencies:
          - CSA_IPFILTER_TENANT_HTTP
          - CSL_ENTRY_HTTP
        expressions:
          install: |
            add cs policy PLH_CSP_GOTO_CSL_IPFILTER_TENANT_HTTP -rule q{true}
            add cs policy PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_HTTP -rule q{!PLH_PSM_TENANT_IPV4_HTTP_KEY_EXISTS} -action PLH_CSA_IPFILTER_TENANT_HTTP
            add cs policy PLH_CSP_IPFILTER_TENANT_NOT_ENABLED_HTTP -rule q{}
            add cs policy PLH_CSP_IPFILTER_TENANT_IPV4_HTTP -rule q{!CLIENT.IP.SRC.IS_IPV6}
            add cs policy PLH_CSP_IPFILTER_TENANT_IPV6_HTTP -rule q{!CLIENT.IP.SRC.IS_IPV6}

            add cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP HTTP
            bind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_HTTP 10001
            bind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV4_HTTP 10003
            bind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV6_HTTP 10004

            bind cs policylabel PLH_CSL_ENTRY_HTTP PLH_CSP_GOTO_CSL_IPFILTER_TENANT_HTTP 101 -invoke policylabel PLH_CSL_IPFILTER_TENANT_HTTP
          uninstall: |
            unbind cs policylabel PLH_CSL_ENTRY_HTTP PLH_CSP_GOTO_CSL_IPFILTER_TENANT_HTTP

            unbind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV6_HTTP
            unbind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV4_HTTP
            unbind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_HTTP
            rm cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP

            rm cs policy PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_HTTP
            rm cs policy PLH_CSP_GOTO_CSL_IPFILTER_TENANT_HTTP

      - name: CSL_IPFILTER_TENANT_TCP
        references:
          - PLH_CSP_GOTO_CSL_IPFILTER_TENANT_TCP
          - PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_TCP
          - PLH_PSM_TENANT_IPV4_TCP_KEY_EXISTS
          - PLH_CSA_IPFILTER_TENANT_TCP
          - PLH_CSL_IPFILTER_TENANT_TCP
          - PLH_CSL_ENTRY_TCP
        dependencies:
          - CSA_IPFILTER_TENANT_TCP
          - CSL_ENTRY_TCP
        expressions:
          install: |
            add cs policy PLH_CSP_GOTO_CSL_IPFILTER_TENANT_TCP -rule q{true}
            add cs policy PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_TCP -rule q{!PLH_PSM_TENANT_IPV4_TCP_KEY_EXISTS} -action PLH_CSA_IPFILTER_TENANT_TCP

            add cs policylabel PLH_CSL_IPFILTER_TENANT_TCP TCP
            bind cs policylabel PLH_CSL_IPFILTER_TENANT_TCP PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_TCP 10001

            bind cs policylabel PLH_CSL_ENTRY_TCP PLH_CSP_GOTO_CSL_IPFILTER_TENANT_TCP 101 -invoke policylabel PLH_CSL_IPFILTER_TENANT_TCP
          uninstall: |
            unbind cs policylabel PLH_CSL_ENTRY_TCP PLH_CSP_GOTO_CSL_IPFILTER_TENANT_TCP

            unbind cs policylabel PLH_CSL_IPFILTER_TENANT_TCP
            rm cs policylabel PLH_CSL_IPFILTER_TENANT_TCP PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_TCP

            rm cs policy PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_TCP
            rm cs policy PLH_CSP_GOTO_CSL_IPFILTER_TENANT_TCP

      - name: CSL_IPFILTER_TENANT_UDP
        references:
          - PLH_CSP_GOTO_CSL_IPFILTER_TENANT_UDP
          - PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_UDP
          - PLH_PSM_TENANT_IPV4_UDP_KEY_EXISTS
          - PLH_CSA_IPFILTER_TENANT_UDP
          - PLH_CSL_IPFILTER_TENANT_UDP
          - PLH_CSL_ENTRY_UDP
        dependencies:
          - CSA_IPFILTER_TENANT_UDP
          - CSL_ENTRY_UDP
        expressions:
          install: |
            add cs policy PLH_CSP_GOTO_CSL_IPFILTER_TENANT_UDP -rule q{true}
            add cs policy PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_UDP -rule q{!PLH_PSM_TENANT_IPV4_UDP_KEY_EXISTS} -action PLH_CSA_IPFILTER_TENANT_UDP

            add cs policylabel PLH_CSL_IPFILTER_TENANT_UDP UDP
            bind cs policylabel PLH_CSL_IPFILTER_TENANT_UDP PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_UDP 10001

            bind cs policylabel PLH_CSL_ENTRY_UDP PLH_CSP_GOTO_CSL_IPFILTER_TENANT_UDP 101 -invoke policylabel PLH_CSL_IPFILTER_TENANT_UDP
          uninstall: |
            unbind cs policylabel PLH_CSL_ENTRY_UDP PLH_CSP_GOTO_CSL_IPFILTER_TENANT_UDP

            unbind cs policylabel PLH_CSL_IPFILTER_TENANT_UDP
            rm cs policylabel PLH_CSL_IPFILTER_TENANT_UDP PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_UDP

            rm cs policy PLH_CSP_IPFILTER_TENANT_NOT_CONFIGURED_UDP
            rm cs policy PLH_CSP_GOTO_CSL_IPFILTER_TENANT_UDP




      # - name: CSP_IPFILTER_TENANT_IPV4_HTTP
      #   references:
      #     - PLH_CSP_IPFILTER_TENANT_IPV4_HTTP
      #     - PLH_CSL_IPFILTER_TENANT_HTTP
      #   dependencies:
      #     - CSL_IPFILTER_TENANT_HTTP
      #   expressions:
      #     install: |
      #       add cs policy PLH_CSP_IPFILTER_TENANT_IPV4_HTTP -rule q{!CLIENT.IP.SRC.IS_IPV6}
      #       bind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV4_HTTP 10101 -gotoPriorityExpression 10201
      #     uninstall: |
      #       unbind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV4_HTTP
      #       rm cs policy PLH_CSP_IPFILTER_TENANT_IPV4_HTTP

      # - name: CSP_IPFILTER_TENANT_IPV6_HTTP
      #   references:
      #     - PLH_CSP_IPFILTER_TENANT_IPV6_HTTP
      #     - PLH_CSL_IPFILTER_TENANT_HTTP
      #   expressions:
      #     install: |
      #       add cs policy PLH_CSP_IPFILTER_TENANT_IPV6_HTTP -rule q{!CLIENT.IPV6.SRC.IS_IPV4}
      #       bind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV6_HTTP 10102 -gotoPriorityExpression 10211
      #     uninstall: |
      #       unbind cs policylabel PLH_CSL_IPFILTER_TENANT_HTTP PLH_CSP_IPFILTER_TENANT_IPV6
      #       rm cs policy PLH_CSP_IPFILTER_TENANT_IPV6
