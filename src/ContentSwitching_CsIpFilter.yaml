name: ContentSwitching_CsIpFilter
dependencies:
  - Core
  - ContentSwitchingEntry
placeholders:
  - name: PLH_CSL_CSIPFILTER_HTTP
    expression: CSL__V__CSIPFILTER_HTTP
  - name: PLH_CSL_CSIPFILTER_TCP
    expression: CSL__V__CSIPFILTER_TCP
  - name: PLH_CSL_CSIPFILTER_UDP
    expression: CSL__V__CSIPFILTER_UDP

  - name: PLH_LOG_CSP_CSIPFILTER_HTTP
    expression: LOG__V__CSP_CSIPFILTER_HTTP
  - name: PLH_LOG_CSP_CSIPFILTER_TCP
    expression: LOG__V__CSP_CSIPFILTER_TCP
  - name: PLH_LOG_CSP_CSIPFILTER_UDP
    expression: LOG__V__CSP_CSIPFILTER_UDP

  - name: PLH_CSP_CSIPFILTER_HTTP
    expression: CSP__V__CSIPFILTER_HTTP
  - name: PLH_CSP_CSIPFILTER_TCP
    expression: CSP__V__CSIPFILTER_TCP
  - name: PLH_CSP_CSIPFILTER_UDP
    expression: CSP__V__CSIPFILTER_UDP



sections:
  - name: Auditing.MessageActions
    elements:
      - name: LOG_CSP_CSIPFILTER_HTTP
        references:
          - PLH_LOG_CSP_CSIPFILTER_HTTP
        expressions:
          install: add audit messageAction PLH_LOG_CSP_CSIPFILTER_HTTP INFO q{PLH_PSM_CS_TCP_KEY + "policy=PLH_LOG_CSP_CSIPFILTER_HTTP"}
          uninstall: rm audit messageAction PLH_LOG_CSP_CSIPFILTER_HTTP

      - name: LOG_CSP_CSIPFILTER_TCP
        references:
          - PLH_LOG_CSP_CSIPFILTER_TCP
        expressions:
          install: add audit messageAction PLH_LOG_CSP_CSIPFILTER_TCP INFO q{PLH_PSM_CS_TCP_KEY + "policy=PLH_LOG_CSP_CSIPFILTER_TCP"}
          uninstall: rm audit messageAction PLH_LOG_CSP_CSIPFILTER_TCP

      - name: LOG_CSP_CSIPFILTER_UDP
        references:
          - PLH_LOG_CSP_CSIPFILTER_UDP
        expressions:
          install: add audit messageAction PLH_LOG_CSP_CSIPFILTER_UDP INFO q{PLH_PSM_CS_UDP_KEY + "policy=PLH_LOG_CSP_CSIPFILTER_UDP"}
          uninstall: rm audit messageAction PLH_LOG_CSP_CSIPFILTER_UDP



  - name: TrafficManagement.ContentSwitching.ContentSwitchingPolicyLabels
    elements:
      - name: CSL_CSIPFILTER_HTTP
        references:
          - PLH_CSL_CSIPFILTER_HTTP
          - PLH_CSL_ENTRY_HTTP
        dependencies:
          - CSL_ENTRY_HTTP
          - CSP_CSIPFILTER_HTTP
        expressions:
          install: |
            add cs policylabel PLH_CSL_CSIPFILTER_HTTP HTTP
            bind cs policylabel PLH_CSL_ENTRY_HTTP PLH_CSP_CSIPFILTER_HTTP 2011 -invoke policylabel PLH_CSL_CSIPFILTER_HTTP
          uninstall: |
            unbind cs policylabel PLH_CSL_ENTRY_HTTP PLH_CSP_CSIPFILTER_HTTP
            rm cs policylabel PLH_CSL_CSIPFILTER_HTTP

      - name: CSL_CSIPFILTER_TCP
        references:
          - PLH_CSL_CSIPFILTER_TCP
          - PLH_CSL_ENTRY_TCP
        dependencies:
          - CSL_ENTRY_TCP
          - CSP_CSIPFILTER_TCP
        expressions:
          install: |
            add cs policylabel PLH_CSL_CSIPFILTER_TCP TCP
            bind cs policylabel PLH_CSL_ENTRY_TCP PLH_CSP_CSIPFILTER_TCP 2011 -invoke policylabel PLH_CSL_CSIPFILTER_TCP
          uninstall: |
            unbind cs policylabel PLH_CSL_ENTRY_TCP PLH_CSP_CSIPFILTER_TCP
            rm cs policylabel PLH_CSL_CSIPFILTER_TCP

      - name: CSL_CSIPFILTER_UDP
        references:
          - PLH_CSL_CSIPFILTER_UDP
          - PLH_CSL_ENTRY_UDP
        dependencies:
          - CSL_ENTRY_UDP
          - CSP_CSIPFILTER_UDP
        expressions:
          install: |
            add cs policylabel PLH_CSL_CSIPFILTER_UDP UDP
            bind cs policylabel PLH_CSL_ENTRY_UDP PLH_CSP_CSIPFILTER_UDP 2011 -invoke policylabel PLH_CSL_CSIPFILTER_UDP
          uninstall: |
            unbind cs policylabel PLH_CSL_ENTRY_UDP PLH_CSP_CSIPFILTER_UDP
            rm cs policylabel PLH_CSL_CSIPFILTER_UDP



  - name: TrafficManagement.ContentSwitching.ContentSwitchingPolicies
    elements:
      - name: CSP_CSIPFILTER_HTTP
        references:
          - PLH_CSP_CSIPFILTER_HTTP
          - PLH_LOG_CSP_CSIPFILTER_HTTP
        dependencies:
          - LOG_CSP_CSIPFILTER_HTTP
        expressions:
          install: add cs policy PLH_CSP_CSIPFILTER_HTTP -rule q{true} -logAction PLH_LOG_CSP_CSIPFILTER_HTTP
          uninstall: rm cs policy PLH_CSP_CSIPFILTER_HTTP

      - name: CSP_CSIPFILTER_TCP
        references:
          - PLH_CSP_CSIPFILTER_TCP
          - PLH_LOG_CSP_CSIPFILTER_TCP
        dependencies:
          - LOG_CSP_CSIPFILTER_TCP
        expressions:
          install: add cs policy PLH_CSP_CSIPFILTER_TCP -rule q{true} -logAction PLH_LOG_CSP_CSIPFILTER_TCP
          uninstall: rm cs policy PLH_CSP_CSIPFILTER_TCP

      - name: CSP_CSIPFILTER_UDP
        references:
          - PLH_CSP_CSIPFILTER_UDP
          - PLH_LOG_CSP_CSIPFILTER_UDP
        dependencies:
          - LOG_CSP_CSIPFILTER_UDP
        expressions:
          install: add cs policy PLH_CSP_CSIPFILTER_UDP -rule q{true} -logAction PLH_LOG_CSP_CSIPFILTER_UDP
          uninstall: rm cs policy PLH_CSP_CSIPFILTER_UDP