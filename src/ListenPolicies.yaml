name: LISTENPOLICIES
dependencies:
  - CORE
placeholders:
  ############################################################
  # EXPRESSION PLACEHOLDERS
  # IPV4
  - name: PLH_EXP_LPE_IPV4_HTTP
    expression: _V__EXP_LPE_IPV4_HTTP
  - name: PLH_EXP_LPE_IPV4_SSL
    expression: _V__EXP_LPE_IPV4_SSL
  - name: PLH_EXP_LPE_IPV4_SSLBRIDGE
    expression: _V__EXP_LPE_IPV4_SSLBRIDGE
  - name: PLH_EXP_LPE_IPV4_TCP
    expression: _V__EXP_LPE_IPV4_TCP
  - name: PLH_EXP_LPE_IPV4_SSLTCP
    expression: _V__EXP_LPE_IPV4_SSLTCP
  - name: PLH_EXP_LPE_IPV4_UDP
    expression: _V__EXP_LPE_IPV4_UDP

  # IPV6
  - name: PLH_EXP_LPE_IPV6_HTTP
    expression: _V__EXP_LPE_IPV6_HTTP
  - name: PLH_EXP_LPE_IPV6_SSL
    expression: _V__EXP_LPE_IPV6_SSL
  - name: PLH_EXP_LPE_IPV6_SSLBRIDGE
    expression: _V__EXP_LPE_IPV6_SSLBRIDGE
  - name: PLH_EXP_LPE_IPV6_TCP
    expression: _V__EXP_LPE_IPV6_TCP
  - name: PLH_EXP_LPE_IPV6_SSLTCP
    expression: _V__EXP_LPE_IPV6_SSLTCP
  - name: PLH_EXP_LPE_IPV6_UDP
    expression: _V__EXP_LPE_IPV6_UDP

sections:
  - name: AppExpert.AdvancedExpressions
    elements:
      ############################################################
      # LISTEN POLICIES
      # HTTP
      - name: EXP_LPE_HTTP
        references:
          - PLH_EXP_LPE_IPV4_HTTP
          - PLH_EXP_LPE_IPV6_HTTP
          - PLH_PSM_ENDPOINT_IPV4_HTTP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV4_HTTP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV4_HTTP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV4_HTTP_VALUE_STATE_ISDISABLED
          - PLH_PSM_ENDPOINT_IPV6_HTTP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV6_HTTP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV6_HTTP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV6_HTTP_VALUE_STATE_ISDISABLED
        dependencies:
          - PSM_ENDPOINT
          - PSM_TENANT
        expressions:
          install: |
            add policy expression PLH_EXP_LPE_IPV4_HTTP q{(PLH_PSM_ENDPOINT_IPV4_HTTP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV4_HTTP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV4_HTTP_KEY_EXISTS && PLH_PSM_TENANT_IPV4_HTTP_VALUE_STATE_ISDISABLED.NOT)}
            add policy expression PLH_EXP_LPE_IPV6_HTTP q{(PLH_PSM_ENDPOINT_IPV6_HTTP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV6_HTTP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV6_HTTP_KEY_EXISTS && PLH_PSM_TENANT_IPV6_HTTP_VALUE_STATE_ISDISABLED.NOT)}
          uninstall: |
            rm policy expression PLH_EXP_LPE_IPV4_HTTP
            rm policy expression PLH_EXP_LPE_IPV6_HTTP

      # SSL
      - name: EXP_LPE_SSL
        references:
          - PLH_EXP_LPE_IPV4_SSL
          - PLH_EXP_LPE_IPV6_SSL
          - PLH_PSM_ENDPOINT_IPV4_SSL_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV4_SSL_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV4_SSL_KEY_EXISTS
          - PLH_PSM_TENANT_IPV4_SSL_VALUE_STATE_ISDISABLED
          - PLH_PSM_ENDPOINT_IPV6_SSL_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV6_SSL_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV6_SSL_KEY_EXISTS
          - PLH_PSM_TENANT_IPV6_SSL_VALUE_STATE_ISDISABLED
        dependencies:
          - PSM_ENDPOINT
          - PSM_TENANT
        expressions:
          install: |
            add policy expression PLH_EXP_LPE_IPV4_SSL q{(PLH_PSM_ENDPOINT_IPV4_SSL_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV4_SSL_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV4_SSL_KEY_EXISTS && PLH_PSM_TENANT_IPV4_SSL_VALUE_STATE_ISDISABLED.NOT)}
            add policy expression PLH_EXP_LPE_IPV6_SSL q{(PLH_PSM_ENDPOINT_IPV6_SSL_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV6_SSL_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV6_SSL_KEY_EXISTS && PLH_PSM_TENANT_IPV6_SSL_VALUE_STATE_ISDISABLED.NOT)}
          uninstall: |
            rm policy expression PLH_EXP_LPE_IPV4_SSL
            rm policy expression PLH_EXP_LPE_IPV6_SSL

      # SSLBRIDGE
      - name: EXP_LPE_SSLBRIDGE
        references:
          - PLH_EXP_LPE_IPV4_SSLBRIDGE
          - PLH_EXP_LPE_IPV6_SSLBRIDGE
          - PLH_PSM_ENDPOINT_IPV4_SSLBRIDGE_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV4_SSLBRIDGE_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV4_SSLBRIDGE_KEY_EXISTS
          - PLH_PSM_TENANT_IPV4_SSLBRIDGE_VALUE_STATE_ISDISABLED
          - PLH_PSM_ENDPOINT_IPV6_SSLBRIDGE_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV6_SSLBRIDGE_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV6_SSLBRIDGE_KEY_EXISTS
          - PLH_PSM_TENANT_IPV6_SSLBRIDGE_VALUE_STATE_ISDISABLED
        dependencies:
          - PSM_ENDPOINT
          - PSM_TENANT
        expressions:
          install: |
            add policy expression PLH_EXP_LPE_IPV4_SSLBRIDGE q{(PLH_PSM_ENDPOINT_IPV4_SSLBRIDGE_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV4_SSLBRIDGE_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV4_SSLBRIDGE_KEY_EXISTS && PLH_PSM_TENANT_IPV4_SSLBRIDGE_VALUE_STATE_ISDISABLED.NOT)}
            add policy expression PLH_EXP_LPE_IPV6_SSLBRIDGE q{(PLH_PSM_ENDPOINT_IPV6_SSLBRIDGE_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV6_SSLBRIDGE_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV6_SSLBRIDGE_KEY_EXISTS && PLH_PSM_TENANT_IPV6_SSLBRIDGE_VALUE_STATE_ISDISABLED.NOT)}
          uninstall: |
            rm policy expression PLH_EXP_LPE_IPV4_SSLBRIDGE
            rm policy expression PLH_EXP_LPE_IPV6_SSLBRIDGE

      # TCP
      - name: EXP_LPE_TCP
        references:
          - PLH_EXP_LPE_IPV4_TCP
          - PLH_EXP_LPE_IPV6_TCP
          - PLH_PSM_ENDPOINT_IPV4_TCP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV4_TCP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV4_TCP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV4_TCP_VALUE_STATE_ISDISABLED
          - PLH_PSM_ENDPOINT_IPV6_TCP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV6_TCP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV6_TCP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV6_TCP_VALUE_STATE_ISDISABLED
        dependencies:
          - PSM_ENDPOINT
          - PSM_TENANT
        expressions:
          install: |
            add policy expression PLH_EXP_LPE_IPV4_TCP q{(PLH_PSM_ENDPOINT_IPV4_TCP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV4_TCP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV4_TCP_KEY_EXISTS && PLH_PSM_TENANT_IPV4_TCP_VALUE_STATE_ISDISABLED.NOT)}
            add policy expression PLH_EXP_LPE_IPV6_TCP q{(PLH_PSM_ENDPOINT_IPV6_TCP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV6_TCP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV6_TCP_KEY_EXISTS && PLH_PSM_TENANT_IPV6_TCP_VALUE_STATE_ISDISABLED.NOT)}
          uninstall: |
            rm policy expression PLH_EXP_LPE_IPV4_TCP
            rm policy expression PLH_EXP_LPE_IPV6_TCP

      # SSLTCP
      - name: EXP_LPE_SSLTCP
        references:
          - PLH_EXP_LPE_IPV4_SSLTCP
          - PLH_EXP_LPE_IPV6_SSLTCP
          - PLH_PSM_ENDPOINT_IPV4_SSLTCP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV4_SSLTCP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV4_SSLTCP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV4_SSLTCP_VALUE_STATE_ISDISABLED
          - PLH_PSM_ENDPOINT_IPV6_SSLTCP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV6_SSLTCP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV6_SSLTCP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV6_SSLTCP_VALUE_STATE_ISDISABLED
        dependencies:
          - PSM_ENDPOINT
          - PSM_TENANT
        expressions:
          install: |
            add policy expression PLH_EXP_LPE_IPV4_SSLTCP q{(PLH_PSM_ENDPOINT_IPV4_SSLTCP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV4_SSLTCP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV4_SSLTCP_KEY_EXISTS && PLH_PSM_TENANT_IPV4_SSLTCP_VALUE_STATE_ISDISABLED.NOT)}
            add policy expression PLH_EXP_LPE_IPV6_SSLTCP q{(PLH_PSM_ENDPOINT_IPV6_SSLTCP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV6_SSLTCP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV6_SSLTCP_KEY_EXISTS && PLH_PSM_TENANT_IPV6_SSLTCP_VALUE_STATE_ISDISABLED.NOT)}
          uninstall: |
            rm policy expression PLH_EXP_LPE_IPV4_SSLTCP
            rm policy expression PLH_EXP_LPE_IPV6_SSLTCP

      # UDP
      - name: EXP_LPE_UDP
        references:
          - PLH_EXP_LPE_IPV4_UDP
          - PLH_EXP_LPE_IPV6_UDP
          - PLH_PSM_ENDPOINT_IPV4_UDP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV4_UDP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV4_UDP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV4_UDP_VALUE_STATE_ISDISABLED
          - PLH_PSM_ENDPOINT_IPV6_UDP_KEY_EXISTS
          - PLH_PSM_ENDPOINT_IPV6_UDP_VALUE_STATE_ISDISABLED
          - PLH_PSM_TENANT_IPV6_UDP_KEY_EXISTS
          - PLH_PSM_TENANT_IPV6_UDP_VALUE_STATE_ISDISABLED
        dependencies:
          - PSM_ENDPOINT
          - PSM_TENANT
        expressions:
          install: |
            add policy expression PLH_EXP_LPE_IPV4_UDP q{(PLH_PSM_ENDPOINT_IPV4_UDP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV4_UDP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV4_UDP_KEY_EXISTS && PLH_PSM_TENANT_IPV4_UDP_VALUE_STATE_ISDISABLED.NOT)}
            add policy expression PLH_EXP_LPE_IPV6_UDP q{(PLH_PSM_ENDPOINT_IPV6_UDP_KEY_EXISTS && PLH_PSM_ENDPOINT_IPV6_UDP_VALUE_STATE_ISDISABLED.NOT && PLH_PSM_TENANT_IPV6_UDP_KEY_EXISTS && PLH_PSM_TENANT_IPV6_UDP_VALUE_STATE_ISDISABLED.NOT)}
          uninstall: |
            rm policy expression PLH_EXP_LPE_IPV4_UDP
            rm policy expression PLH_EXP_LPE_IPV6_UDP