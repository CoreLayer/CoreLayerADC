# dependency:/src/appexpert/stringmaps/SM_CL01_00_L8_DEBUG_KEYS.conf
# dependency:/src/appexpert/variables/VAR_CL01_00_L8.conf
add policy expression PE_CL01_00_L8_HTTP_DEBUG "HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG\").EXISTS && HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG-TOKEN\").EXISTS"

add policy expression PE_CL01_00_L8_HTTP_DEBUG_CREATE_TOKEN "HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG\").TO_LOWER.EQ(\"register\")"
add policy expression PE_CL01_00_L8_HTTP_DEBUG_NEW_TOKEN "((HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG-TOKEN\").B64ENCODE + SYS.UUID.B64ENCODE) + SYS.NANO_TIME).B64ENCODE"
add policy expression PE_CL01_00_L8_HTTP_DEBUG_STORE_TOKEN "HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG\").TO_LOWER.EQ(\"register\") && HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG-TOKEN\").IS_STRINGMAP_KEY(\"SM_CL01_00_L8_DEBUG_KEYS\")"
add policy expression PE_CL01_00_L8_HTTP_DEBUG_RETURN_TOKEN "HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG\").TO_LOWER.EQ(\"register\") && HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG-TOKEN\").IS_STRINGMAP_KEY(\"SM_CL01_00_L8_DEBUG_KEYS\")"

add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML "$VAR_CL01_00_L8_DEBUG_TOKENS.valueExists(HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG-TOKEN\")) && HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG\").TO_LOWER.EQ(\"html\")"
add policy expression PE_CL01_00_L8_HTTP_DEBUG_JSON "$VAR_CL01_00_L8_DEBUG_TOKENS.valueExists(HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG-TOKEN\")) && HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG\").TO_LOWER.EQ(\"json\")"
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HEAD "$VAR_CL01_00_L8_DEBUG_TOKENS.valueExists(HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG-TOKEN\")) && HTTP.REQ.HEADER(\"X-CORELAYER-DEBUG\").TO_LOWER.EQ(\"header\")"

# General HTML OUTPUT expressions
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_002 q{"<table class=\"layer2\"><caption>Layer 2 information</caption><thead><th>Variable</th><th>Value</th></thead><tbody>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_003 q{"<table class=\"layer3\"><caption>Layer 3 information</caption><thead><th>Variable</th><th>Value</th></thead><tbody>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_004 q{"<table class=\"layer4\"><caption>Layer 4 information</caption><thead><th>Variable</th><th>Value</th></thead><tbody>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_005 q{"<table class=\"layer5\"><caption>Layer 5 information</caption><thead><th>Variable</th><th>Value</th></thead><tbody>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_007 q{"<table class=\"layer7\"><caption>Layer 7 information</caption><thead><th>Variable</th><th>Value</th></thead><tbody>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_008 q{"<table class=\"layer8\"><caption>Layer 8 information</caption><thead><th>Variable</th><th>Value</th></thead><tbody>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_999 q{"</tbody></table>"}

# L2 HTML OUTPUT
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_021 q{"<tr><td>VLAN</td><td>" + $VAR_CL01_00_L2_VLAN + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_022 q{"<tr><td>SRC MAC</td><td>" + $VAR_CL01_00_L2_SRCMAC + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_023 q{"<tr><td>DST MAC</td><td>" + $VAR_CL01_00_L2_DSTMAC + "</td></tr>"}

# L3 HTML OUTPUT
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_031 q{"<tr><td>IP VERSION</td><td>" + $VAR_CL01_00_L3_IPVERSION + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_032 q{"<tr><td>IP ADDRESS</td><td>" + $VAR_CL01_00_L3_IPADDRESS + "</td></tr>"}

# L4 HTML OUTPUT
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_041 q{"<tr><td>PROTOCOL</td><td>" + $VAR_CL01_00_L4_PROTOCOL + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_042 q{"<tr><td>SRC PORT</td><td>" + $VAR_CL01_00_L4_SRCPORT + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_043 q{"<tr><td>DST PORT</td><td>" + $VAR_CL01_00_L4_DSTPORT + "</td></tr>"}

# L5 HTML OUTPUT
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_051 q{"<tr><td>CIPHER NAME</td><td>" + $VAR_CL01_00_L5_SSL_CIPHER + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_052 q{"<tr><td>CIPHER BITS</td><td>" + $VAR_CL01_00_L5_SSL_BITS + "</td></tr>"}

# L7 HTML OUTOUT
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_071 q{"<tr><td>FQDN</td><td>" + $VAR_CL01_00_L7_HTTP_FQDN + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_072 q{"<tr><td>URL PATH</td><td>" + $VAR_CL01_00_L7_HTTP_PATH + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_073 q{"<tr><td>URL QUERY</td><td>" + $VAR_CL01_00_L7_HTTP_QUERY + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_074 q{"<tr><td>USER-AGENT</td><td>" + $VAR_CL01_00_L7_HTTP_UA + "</td></tr>"}

# L8 HTML OUTPUT
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_201 q{"<tr><td>CS</td><td>" + $VAR_CL01_00_L8_CS + "</td></tr>"}
add policy expression PE_CL01_00_L8_HTTP_DEBUG_HTML_202 q{"<tr><td>LB</td><td>" + $VAR_CL01_00_L8_LB + "</td></tr>"}


add policy expression PE_CL01_00_L8_HTTP_DEBUG_JSON_00 "\"{\""
add policy expression PE_CL01_00_L8_HTTP_DEBUG_JSON_99 "\"}\""